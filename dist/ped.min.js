!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.PED=e():t.PED=e()}(window,function(){return n={},i.m=o=[function(t,e,o){"use strict";o.r(e);var m={img:{_width:0,_height:0,_WH:0,_HW:0},device:{_width:0,_height:0},boxSize:{_width:0,_height:0},operateType:0,imgInstance:null,canvas:{},textBox:{},textInput:{},textOperateIndex:0,textIndex:0,inputArray:[],inputDomArray:[],canvasParentDom:null,canvasGrandDom:null,pictureEditBox:null,canvasContext:{},paintingArray:[]};function n(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var x=0;function r(t,e){var o=t,n=document.createElement(e||"div");return n.innerHTML=o,n.firstChild}function i(l){var c={x:0,y:0},d=null,p=1;x=(l.width/parseFloat(l.style.width)).toFixed(4);var u=m.canvasContext,h=m.canvasParentDom.offsetTop,f=m.canvasParentDom.offsetLeft;l.addEventListener("touchstart",function(t){if(2===t.touches.length)d=t.touches;else if(1===t.touches.length&&1==m.operateType){y(c,t),u.beginPath(),u.lineWidth=5;var e=(t.touches[0].pageX-f-document.body.scrollLeft+m.canvasGrandDom.scrollLeft)*x,o=(t.touches[0].pageY-h-document.body.scrollTop+m.canvasGrandDom.scrollTop)*x;u.moveTo(e,o),m.paintingArray.push({start:{x:e,y:o},moves:[]})}},!1),l.addEventListener("touchmove",function(t){if(2===t.touches.length){t.preventDefault(),g(),m.operateType=0,p=function(t,e){var o=v(t[0],t[1]);return(v(e[0],e[1])/o).toFixed(4)}(d,t.touches),d=t.touches;var e=parseFloat(l.style.width),o=parseFloat(l.style.height),n=(e*p).toFixed(4),i=parseFloat((e*m.img._WH).toFixed(4));l.style.width=n+"px",l.style.height=i+"px",x=(l.width/parseFloat(n)).toFixed(4),h=m.canvasParentDom.offsetTop,f=m.canvasParentDom.offsetLeft,function(){var t=m.boxSize._height-parseFloat(m.canvas.style.height),e=m.boxSize._width-parseFloat(m.canvas.style.width);0<t?m.canvasGrandDom.style.paddingTop=(t/2).toFixed(4)+"px":"0px"!==m.canvasGrandDom.style.paddingTop&&(m.canvasGrandDom.style.paddingTop="0px");0<e?m.canvasGrandDom.style.paddingLeft=(e/2).toFixed(4)+"px":"0px"!==m.canvasGrandDom.style.paddingLeft&&(m.canvasGrandDom.style.paddingLeft="0px")}(),0<m.inputDomArray.length&&m.inputDomArray.forEach(function(t){t.style.fontSize=(parseFloat(t.style.fontSize)*p).toFixed(4)+"px",t.style.top=(parseFloat(t.style.top)/o*i).toFixed(4)+"px",t.style.left=(parseFloat(t.style.left)/e*n).toFixed(4)+"px"})}else if(1===t.touches.length&&1==m.operateType){t.preventDefault();var a=parseFloat((t.touches[0].pageX-f-document.body.scrollLeft+m.canvasGrandDom.scrollLeft)*x),r=parseFloat((t.touches[0].pageY-h-document.body.scrollTop+m.canvasGrandDom.scrollTop)*x);u.lineTo(a,r),u.stroke(),y(c,t);var s=m.paintingArray.length-1;m.paintingArray[s].moves.push({x:a,y:r})}},{passive:!1})}function a(){m.textInput.addEventListener("blur",function(){var t=m.textInput.innerText.split(/[\n\r]+/);m.textBox.style.display="none";if(0<t.length){if(m.inputArray.push(t),0==m.textOperateIndex){for(var e='<div style="position: absolute;font-size: '.concat("15px",';background-color: white;padding: 3px 5px;border-radius: 5px;white-space: nowrap">'),o=0;o<t.length;o++)e=e+t[o]+"".concat(o==t.length-1?"":"</br>");var n=r(e+="</div>");m.canvasParentDom.appendChild(n);var i=n.offsetWidth,a=n.offsetHeight;n.style.top=(m.boxSize._height-a)/2+m.canvasGrandDom.scrollTop-parseFloat(m.canvasGrandDom.style.paddingTop||0)+"px",n.style.left=(m.boxSize._width-i)/2+m.canvasGrandDom.scrollLeft-parseFloat(m.canvasGrandDom.style.paddingLeft||0)+"px",m.inputDomArray.push(n),function(a){var r={x:0,y:0},s={top:0,left:0};a.addEventListener("touchstart",function(t){t.preventDefault(),r.x=t.touches[0].pageX-document.body.scrollLeft,r.y=t.touches[0].pageY-document.body.scrollTop,s.top=parseFloat(a.style.top),s.left=parseFloat(a.style.left)},!1),a.addEventListener("touchmove",function(t){if(t.preventDefault(),1==t.touches.length){var e=t.touches[0].pageX-document.body.scrollLeft-r.x,o=t.touches[0].pageY-document.body.scrollTop-r.y;r.x=t.touches[0].pageX-document.body.scrollLeft,r.y=t.touches[0].pageY-document.body.scrollTop;var n=s.left+e,i=s.top+o;s.top=i,s.left=n,a.style.left=n.toFixed(4)+"px",a.style.top=i.toFixed(4)+"px"}else t.touches.length},!1)}(n)}m.textIndex++}m.textInput.innerText="",m.textBox.style.display="none",m.textInput.style.display="none"})}function g(){var t=n(document.querySelectorAll(".picture-operate"))[0];console.log(t.style.color),"rgb(69, 148, 248)"==t.style.color&&(t.firstChild.src="./src/assets/image/painting.png",t.style.color="white")}function s(){n(document.querySelectorAll(".picture-operate")).forEach(function(t){t.addEventListener("click",function(t){var e=t.currentTarget.getAttribute("operate");if(function(t){m.operateType=t}(e),1==e){var o=t.currentTarget;o.firstChild.src="./src/assets/image/painting1.png",o.style.color="#4594f8"}else if(4==e)l(),b(),m.paintingArray=[],g();else if(2==e)m.textBox.style.display="block",m.textInput.style.display="inline-block",m.textInput.focus(),g();else if(3==e){if(0<m.paintingArray.length){l();var n=m.canvasContext;m.paintingArray.pop(),n.beginPath(),m.paintingArray.forEach(function(t){n.moveTo(t.start.x,t.start.y),t.moves.forEach(function(t){n.lineTo(t.x,t.y)})}),n.stroke()}g()}},!1)})}function y(t,e){t.x=e.touches[0].pageX-document.body.scrollLeft,t.y=e.touches[0].pageY-document.body.scrollTop}function v(t,e){var o=e.pageX-t.pageX,n=e.pageY-t.pageY;return Math.sqrt(o*o+n*n)}function l(){m.canvasContext.clearRect(0,0,m.img._width,m.img._height),m.canvasContext.drawImage(m.imgInstance,0,0,m.img._width,m.img._height)}function b(){m.inputDomArray.forEach(function(t){t.remove()}),m.inputDomArray=[],m.inputArray=[]}function c(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d=function(){function o(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.getImgInfo(t),this.getDeviceInfo(),this.saveFn=e}return function(t,e,o){e&&c(t.prototype,e),o&&c(t,o)}(o,[{key:"getImgInfo",value:function(t){var e=new Image;e.crossOrigin="anonymous";var o=this;e.onload=function(){var t=m.img;t._width=this.width,t._height=this.height,t._HW=(this.width/this.height).toFixed(4),t._WH=(this.height/this.width).toFixed(4),m.imgInstance=this,o.showImg()},e.src=t}},{key:"getDeviceInfo",value:function(){m.device._width=document.documentElement.clientWidth,m.device._height=document.documentElement.clientHeight}},{key:"showImg",value:function(){document.getElementById("picture_edit_cancel")&&m.pictureEditBox.remove();var t="style=\"flex: 1;padding-top: 1rem\" class='picture-operate'",e=r('<div style="position: fixed;top: 0;left: 0;right: 0;bottom: 0;overflow: hidden;z-index: 997;background-color: white"><div id="picture_edit_cancel" style="position: absolute;left: 15px;top: 15px;padding: 5px 13px;background-color: white;color: black;z-index: 2;border-radius: 3px">取消</div><div id="picture_edit_save" style="position: absolute;right: 15px;top: 15px;padding: 5px 13px;background-color: #67c23a;color: white;z-index: 2;border-radius: 3px">保存</div><div style="width: 100%;height:calc(100% - 6rem);overflow: scroll;-webkit-overflow-scrolling: touch;overflow-scrolling: touch;box-sizing: border-box"><div style="position: relative">'+'<canvas id="picture_edit_canvas" width="'.concat(m.img._width,'" height="').concat(m.img._height,'" style="width: ').concat(m.device._width+"px",";height: ").concat(Math.floor(m.device._width*m.img._WH)+"px",'"></canvas>')+'</div></div><div style="position: absolute;bottom: 0;left: 0;right: 0;height: 6rem;background-color: black;display: flex;text-align: center;color: white">'+"<div ".concat(t,' operate="1">')+'<img src="./src/assets/image/painting.png" style="width: 1.3rem;display: block;margin: auto;">涂画</div>'+"<div ".concat(t,' operate="2">')+'<img src="./src/assets/image/text.png" style="width: 1.3rem;display: block;margin: auto"> 文字</div>'+"<div ".concat(t,' operate="3">')+'<img src="./src/assets/image/withdraw.png" style="width: 1.3rem;display: block;margin: auto"> 撤回</div>'+"<div ".concat(t,' operate="4">')+'<img src="./src/assets/image/empty.png" style="width: 1.3rem;display: block;margin: auto"> 清空</div></div><div id="picture_edit_text" style="position: absolute;top: 0;left: 0;right: 0;bottom: 0;overflow: hidden;z-index: 2;display: none;background-color: white;opacity: 0.93"></div><div id="picture_edit_input" contenteditable="true" tabindex="1" style="min-height:15%;border-radius: 5px;border: 2px solid #63eca1;outline: none;width: 96%;box-sizing: border-box;position: absolute;top: 8%;left: 2%;right: 2%;display: none;z-index: 2;padding: 3px 5px"></div></div>');document.body.appendChild(e);var o=document.getElementById("picture_edit_canvas");!function(t,e,o){m.canvas=t,m.canvasParentDom=t.parentElement,m.canvasGrandDom=t.parentElement.parentElement,m.canvasContext=t.getContext("2d"),m.textBox=e,m.pictureEditBox=e.parentElement,m.textInput=o,m.boxSize._height=m.canvasGrandDom.offsetHeight,m.boxSize._width=m.canvasGrandDom.offsetWidth}(o,document.getElementById("picture_edit_text"),document.getElementById("picture_edit_input"));var n=(m.boxSize._height-parseFloat(o.style.height)).toFixed(4);0<n&&(m.canvasGrandDom.style.paddingTop=n/2+"px"),m.canvasContext.drawImage(m.imgInstance,0,0,o.width,o.height),i(o),a(),s(),function(t,y,v){t.addEventListener("click",function(){var t,e,o,n,i,a,r,s,l=m.inputArray;if(0<l.length){for(var c=0;c<l.length;c++){var d=m.inputDomArray[c],p=parseFloat(d.style.left),u=parseFloat(d.style.top)/parseFloat(m.canvas.style.height)*m.img._height,h=parseFloat(d.style.fontSize)/parseFloat(m.canvas.style.height)*m.img._height;t=y,e=p*x,o=u,n=parseFloat(d.offsetWidth)*x,i=parseFloat(d.offsetHeight)*x,a=5*x,s=!(r=!0),t.save(),t.beginPath(),t.moveTo(e+a,o),t.arcTo(e+n,o,e+n,o+a,a),t.arcTo(e+n,o+i,e+n-a,o+i,a),t.arcTo(e,o+i,e,o+i-a,a),t.arcTo(e,o,e+a,o,a),r&&t.fill(),s&&t.stroke(),t.restore(),console.log("scaleStyle===",x),y.fillStyle="white",y.fill();for(var f=0;f<l[c].length;f++)y.fillStyle="black",y.font="".concat(h,"px helvetica"),y.fillText(l[c][f],(p+5)*x,u+(f+1)*(1.4*parseFloat(d.style.fontSize))*x)}b()}var g=m.canvas.toDataURL();v(g),m.pictureEditBox.style.display="none",b(),m.paintingArray=[],m.operateType=0},!1)}(document.getElementById("picture_edit_save"),m.canvasContext,this.saveFn),function(t){t.addEventListener("click",function(){m.pictureEditBox.style.display="none",b(),m.paintingArray=[],m.operateType=0},!1)}(document.getElementById("picture_edit_cancel"))}},{key:"showPED",value:function(){m.pictureEditBox.style.display="block"}}]),o}();o.d(e,"imageInfo",function(){return d}),o.d(e,"PED_GlOBAL",function(){return m})}],i.c=n,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0);function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return o[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var o,n});